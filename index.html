<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript" src="shuntingYard.js"></script>
        <script type="text/javascript">
            function getParameter(key) {
                let parameterString = window.location.search.substring(1);
                if (parameterString) {
                    let parameters = parameterString.split("&");
                    for (let i = 0; i < parameters.length; i++) {
                        if (parameters[i].split("=")[0] == key) {
                            return decodeURIComponent(parameters[i].split("=")[1].replace(/\+/g, " "));
                        }
                    }
                }
            }
            function asString() {
                let argument = arguments[0];
                if (Array.isArray(argument)) {
                    return "[" + argument.map(asString).join(",") + "]";
                }
                return String(argument);
            }
            function updateInputValue() {
                let cmd = getParameter("roll");
                if (!cmd) {
                    cmd = "d20";
                }
                document.getElementById('input').value = cmd;
            }
            window.onload = function() {
                let resultContainer = document.getElementById("result");
                if (resultContainer) {
                    let cmd = getParameter("roll");
                    if (cmd) {
                        let parser = new ShuntingYard();
                        let tokens;
                        let postfix;
                        let result;
                        try {
                            tokens = parser.tokenize(cmd);
                            resultContainer.appendChild(document.createTextNode("Tokens: " + asString(tokens)));
                        } catch (err) {
                            resultContainer.appendChild(document.createTextNode(err.message));
                        }
                        resultContainer.appendChild(document.createElement("br"));
                        try {
                            postfix = parser.infixToPostfix(tokens);
                            resultContainer.appendChild(document.createTextNode("Postfix: " + asString(postfix)));
                        } catch (err) {
                            resultContainer.appendChild(document.createTextNode(err.message));
                        }
                        resultContainer.appendChild(document.createElement("br"));
                        try {
                            result = parser.evaluate(postfix);
                            resultContainer.appendChild(document.createTextNode("Result: " + asString(result)));
                        } catch (err) {
                            resultContainer.appendChild(document.createTextNode(err.message));
                        }
                    }
                }
            };
        </script>
    </head>
    <body>
        <form id='form'>
            <input id="input" type="text" name="roll"><input type="submit" value="Roll!">
        </form>
        <script type="text/javascript">
            updateInputValue();
        </script>
        <br />
        <div id="result"/>
    </body>
</html>
